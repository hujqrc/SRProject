/******************************************************************************/
/* 嵌入式语音识别程序     */
/* Copyright (C), 2009-2012, CQUPT. ME&ES., Speech Group.                     */
/******************************************************************************/
/*----------------------------------------------------------------------------*/
/* 文件名  ：MFCC.c                                              */
/* 创建人  ：蒲甫安，Pu.Fuan@gmail.com                                          */
/* 创建日期：2012.05.27                                                       */
/*----------------------------------------------------------------------------*/
/* 文件描述：特征提取                                                         */
/*----------------------------------------------------------------------------*/
/* 函数列表：                                                                 */
/*                                                                            */
/*----------------------------------------------------------------------------*/
/* 修改记录：                                                                 */
/* YYYY-MM-DD ：demo                                                           */
/******************************************************************************/
#include "../SRParamSet/options.h"
#include "../SRParamSet/asrconfig.h"
#include "../SRParamSet/CyDebug.h"
#include "../SRParamSet/typedef.h"
#include "../SRParamSet/datadef.h"
#include "../DSP/fft.h"
#include <math.h>

// 加窗系数，默认提供256的初始参数
#if ((FRAME_SIZE == 256) && (WIN_OPT==WIN_HAMMING))
static CyFLOAT lWindowCoef[256]=
{
	0.0800000000000000f, 0.0801396320901791f, 0.0805584435906266f, 0.0812561802425375f,
	0.0822324184527504f, 0.0834865655509096f, 0.0850178601492729f, 0.0868253726049470f,
	0.0889080055842703f, 0.0912644947289992f, 0.0938934094238956f, 0.0967931536652478f,
	0.0999619670297972f, 0.103397925743485f, 0.107098943849369f, 0.111062774473996f,
	0.115287011191475f, 0.119769089484404f, 0.124506288300781f, 0.129495731705944f,
	0.134734390628539f, 0.140219084699457f, 0.145946484182623f, 0.151913111996467f,
	0.158115345824847f, 0.164549420316138f, 0.171211429369169f, 0.178097328504598f,
	0.185202937320297f, 0.192523942029263f, 0.200055898078497f, 0.207794232847276f,
	0.215734248423172f, 0.223871124454139f, 0.232199921074925f, 0.240715581906049f,
	0.249412937123505f, 0.258286706597345f, 0.267331503097225f, 0.276541835562968f,
	0.285912112438167f, 0.295436645064799f, 0.305109651136783f, 0.314925258210395f,
	0.324877507269410f, 0.334960356342792f, 0.345167684172755f, 0.355493293930949f,
	0.365930916980537f, 0.376474216681854f, 0.387116792239357f, 0.397852182587524f,
	0.408673870313343f, 0.419575285613002f, 0.430549810280395f, 0.441590781725011f,
	0.452691497016760f, 0.463845216955300f, 0.475045170161378f, 0.486284557187706f,
	0.497556554646881f, 0.508854319353835f, 0.520170992480304f, 0.531499703718800f,
	0.542833575453544f, 0.554165726935838f, 0.565489278461346f, 0.576797355546729f,
	0.588083093103121f, 0.599339639603894f, 0.610560161244195f, 0.621737846089724f,
	0.632865908212225f, 0.643937591809204f, 0.654946175305346f, 0.665884975433158f,
	0.676747351290353f, 0.687526708371517f, 0.698216502571607f, 0.708810244158849f,
	0.719301501714633f, 0.729683906037996f, 0.739951154012344f, 0.750097012432047f,
	0.760115321786592f, 0.770000000000000f, 0.779745046123229f, 0.789344543977327f,
	0.798792665745119f, 0.808083675509254f, 0.817211932734458f, 0.826171895691878f,
	0.834958124823446f, 0.843565286044212f, 0.851988153980648f, 0.860221615142946f,
	0.868260671029406f, 0.876100441160999f, 0.883736166044290f, 0.891163210060908f,
	0.898377064281809f, 0.905373349204632f, 0.912147817412476f, 0.918696356152490f,
	0.925014989832710f, 0.931099882435623f, 0.936947339846999f, 0.942553812098577f,
	0.947915895523229f, 0.953030334821319f, 0.957894025036981f, 0.962504013443125f,
	0.966857501334024f, 0.970951845724403f, 0.974784560953977f, 0.978353320196492f,
	0.981655956872329f, 0.984690465963826f, 0.987455005232518f, 0.989947896337551f,
	0.992167625854595f, 0.994112846194642f, 0.995782376422118f, 0.997175202971826f,
	0.998290480264278f, 0.999127531219040f, 0.999685847665791f, 0.999965090652822f,
	0.999965090652822f, 0.999685847665791f, 0.999127531219040f, 0.998290480264278f,
	0.997175202971826f, 0.995782376422118f, 0.994112846194642f, 0.992167625854595f,
	0.989947896337551f, 0.987455005232518f, 0.984690465963826f, 0.981655956872329f,
	0.978353320196492f, 0.974784560953977f, 0.970951845724403f, 0.966857501334024f,
	0.962504013443125f, 0.957894025036981f, 0.953030334821319f, 0.947915895523229f,
	0.942553812098577f, 0.936947339846999f, 0.931099882435623f, 0.925014989832710f,
	0.918696356152490f, 0.912147817412476f, 0.905373349204632f, 0.898377064281809f,
	0.891163210060908f, 0.883736166044290f, 0.876100441160999f, 0.868260671029406f,
	0.860221615142946f, 0.851988153980648f, 0.843565286044212f, 0.834958124823446f,
	0.826171895691878f, 0.817211932734458f, 0.808083675509254f, 0.798792665745119f,
	0.789344543977327f, 0.779745046123229f, 0.770000000000000f, 0.760115321786592f,
	0.750097012432047f, 0.739951154012344f, 0.729683906037996f, 0.719301501714633f,
	0.708810244158849f, 0.698216502571607f, 0.687526708371517f, 0.676747351290353f,
	0.665884975433158f, 0.654946175305346f, 0.643937591809204f, 0.632865908212225f,
	0.621737846089724f, 0.610560161244195f, 0.599339639603894f, 0.588083093103121f,
	0.576797355546729f, 0.565489278461346f, 0.554165726935838f, 0.542833575453544f,
	0.531499703718800f, 0.520170992480304f, 0.508854319353835f, 0.497556554646881f,
	0.486284557187706f, 0.475045170161378f, 0.463845216955300f, 0.452691497016760f,
	0.441590781725011f, 0.430549810280395f, 0.419575285613002f, 0.408673870313343f,
	0.397852182587524f, 0.387116792239357f, 0.376474216681854f, 0.365930916980537f,
	0.355493293930949f, 0.345167684172755f, 0.334960356342792f, 0.324877507269410f,
	0.314925258210395f, 0.305109651136783f, 0.295436645064799f, 0.285912112438167f,
	0.276541835562968f, 0.267331503097225f, 0.258286706597345f, 0.249412937123505f,
	0.240715581906049f, 0.232199921074925f, 0.223871124454139f, 0.215734248423172f,
	0.207794232847276f, 0.200055898078497f, 0.192523942029263f, 0.185202937320297f,
	0.178097328504598f, 0.171211429369169f, 0.164549420316138f, 0.158115345824847f,
	0.151913111996467f, 0.145946484182623f, 0.140219084699457f, 0.134734390628539f,
	0.129495731705944f, 0.124506288300781f, 0.119769089484404f, 0.115287011191475f,
	0.111062774473996f, 0.107098943849369f, 0.103397925743485f, 0.0999619670297972f,
	0.0967931536652478f, 0.0938934094238956f, 0.0912644947289992f, 0.0889080055842703f,
	0.0868253726049470f, 0.0850178601492729f, 0.0834865655509096f, 0.0822324184527504f,
	0.0812561802425375f, 0.0805584435906266f, 0.0801396320901791f, 0.0800000000000000f
};
#else
static CyFLOAT lWindowCoef[FRAME_SIZE];
#endif


// 三角滤波器，默认三角滤波器个数是23个
#if ((TBF_NUM == 23) && (SAMPLE_RATE==8000) && (FRAME_SIZE==256))
static CyINT16 lFilterBankParam[25]=
{
	0,	 1,	 3,	6,	8,
	10,	13,	16,	19,	23,
	27,	31,	35,	40,	45,
	51,	57,	63,	71,	78,
	87,	96,	105, 116, 127
};
#else
static CyINT16 lFilterBankParam[TBF_NUM+2];
#endif

// DCT矩阵，默认倒谱输出是12，三角滤波器个数是23
#if ((CEPS_NUM==12) && (TBF_NUM==23))
static CyFLOAT lDctMatrix[CEPS_NUM][TBF_NUM]=
{
	0.997668769190539f, 0.979084087682323f, 0.942260922118821f, 0.887885218402375f, 0.816969893010442f, 0.730835964278124f,
	0.631087944326053f, 0.519583950035434f, 0.398401089846242f, 0.269796771157024f, 0.136166649096247f, 6.12323399573677e-17f,
	-0.136166649096246f, -0.269796771157024f, -0.398401089846241f, -0.519583950035433f, -0.631087944326053f, -0.730835964278124f,
	-0.816969893010442f, -0.887885218402375f, -0.942260922118820f, -0.979084087682323f, -0.997668769190539f, 0.990685946036331f,
	0.917211301505453f, 0.775711290704420f, 0.576680322114867f, 0.334879612170986f, 0.0682424133646710f, -0.203456013052634f,
	-0.460065037731152f, -0.682553143218654f, -0.854419404546488f, -0.962917287347799f, -1.0f, -0.962917287347799f,
	-0.854419404546489f, -0.682553143218654f, -0.460065037731153f, -0.203456013052634f, 0.0682424133646710f, 0.334879612170986f,
	0.576680322114867f, 0.775711290704420f, 0.917211301505453f, 0.990685946036331f, 0.979084087682323f, 0.816969893010442f,
	0.519583950035434f, 0.136166649096247f, -0.269796771157024f, -0.631087944326053f, -0.887885218402375f, -0.997668769190539f,
	-0.942260922118821f, -0.730835964278124f, -0.398401089846242f, -1.83697019872103e-16f, 0.398401089846242f, 0.730835964278124f,
	0.942260922118820f, 0.997668769190539f, 0.887885218402376f, 0.631087944326053f, 0.269796771157024f, -0.136166649096246f,
	-0.519583950035433f, -0.816969893010441f, -0.979084087682323f, 0.962917287347799f, 0.682553143218654f, 0.203456013052634f,
	-0.334879612170986f, -0.775711290704420f, -0.990685946036331f, -0.917211301505453f, -0.576680322114867f, -0.0682424133646714f,
	0.460065037731152f, 0.854419404546489f, 1.0f, 0.854419404546489f, 0.460065037731153f, -0.0682424133646709f,
	-0.576680322114866f, -0.917211301505453f, -0.990685946036331f, -0.775711290704420f, -0.334879612170987f, 0.203456013052633f,
	0.682553143218653f, 0.962917287347799f, 0.942260922118821f, 0.519583950035434f, -0.136166649096246f, -0.730835964278124f,
	-0.997668769190539f, -0.816969893010442f, -0.269796771157025f, 0.398401089846241f, 0.887885218402375f, 0.979084087682323f,
	0.631087944326054f, 1.19434011948696e-15f, -0.631087944326051f, -0.979084087682323f, -0.887885218402376f, -0.398401089846243f,
	0.269796771157023f, 0.816969893010441f, 0.997668769190539f, 0.730835964278125f, 0.136166649096249f, -0.519583950035431f,
	-0.942260922118820f, 0.917211301505453f, 0.334879612170986f, -0.460065037731152f, -0.962917287347799f, -0.854419404546489f,
	-0.203456013052634f, 0.576680322114867f, 0.990685946036331f, 0.775711290704420f, 0.0682424133646715f, -0.682553143218654f,
	-1.0f, -0.682553143218654f, 0.0682424133646699f, 0.775711290704420f, 0.990685946036331f, 0.576680322114868f,
	-0.203456013052633f, -0.854419404546488f, -0.962917287347800f, -0.460065037731153f, 0.334879612170984f, 0.917211301505453f,
	0.887885218402375f, 0.136166649096247f, -0.730835964278124f, -0.979084087682323f, -0.398401089846241f, 0.519583950035433f,
	0.997668769190539f, 0.631087944326053f, -0.269796771157025f, -0.942260922118820f, -0.816969893010442f, -4.28626379701574e-16f,
	0.816969893010442f, 0.942260922118821f, 0.269796771157024f, -0.631087944326052f, -0.997668769190539f, -0.519583950035434f,
	0.398401089846242f, 0.979084087682323f, 0.730835964278125f, -0.136166649096246f, -0.887885218402375f, 0.854419404546489f,
	-0.0682424133646709f, -0.917211301505453f, -0.775711290704420f, 0.203456013052633f, 0.962917287347799f, 0.682553143218655f,
	-0.334879612170986f, -0.990685946036331f, -0.576680322114868f, 0.460065037731152f, 1.0f, 0.460065037731153f, -0.576680322114866f,
	-0.990685946036331f, -0.334879612170989f, 0.682553143218655f, 0.962917287347799f, 0.203456013052634f, -0.775711290704419f,
	-0.917211301505454f, -0.0682424133646730f, 0.854419404546487f, 0.816969893010442f, -0.269796771157024f, -0.997668769190539f,
	-0.398401089846242f, 0.730835964278124f, 0.887885218402376f, -0.136166649096246f, -0.979084087682323f, -0.519583950035434f,
	0.631087944326051f, 0.942260922118821f, 2.32744789901656e-15f, -0.942260922118820f, -0.631087944326055f, 0.519583950035433f,
	0.979084087682324f, 0.136166649096248f, -0.887885218402374f, -0.730835964278125f, 0.398401089846238f, 0.997668769190539f,
	0.269796771157028f, -0.816969893010441f, 0.775711290704420f, -0.460065037731152f, -0.962917287347799f, 0.0682424133646701f,
	0.990685946036331f, 0.334879612170987f, -0.854419404546488f, -0.682553143218655f, 0.576680322114866f, 0.917211301505454f,
	-0.203456013052631f, -1.0f, -0.203456013052638f, 0.917211301505452f, 0.576680322114870f, -0.682553143218652f, -0.854419404546490f,
	0.334879612170984f, 0.990685946036331f, 0.0682424133646731f, -0.962917287347798f, -0.460065037731157f, 0.775711290704417f,
	0.730835964278124f, -0.631087944326053f, -0.816969893010442f, 0.519583950035433f, 0.887885218402375f, -0.398401089846241f,
	-0.942260922118821f, 0.269796771157025f, 0.979084087682323f, -0.136166649096246f, -0.997668769190539f, 1.10280109986921e-15f,
	0.997668769190539f, 0.136166649096248f, -0.979084087682323f, -0.269796771157024f, 0.942260922118820f, 0.398401089846243f,
	-0.887885218402375f, -0.519583950035434f, 0.816969893010441f, 0.631087944326053f, -0.730835964278124f, 0.682553143218654f,
	-0.775711290704420f, -0.576680322114867f, 0.854419404546489f, 0.460065037731153f, -0.917211301505453f, -0.334879612170987f,
	0.962917287347799f, 0.203456013052634f, -0.990685946036331f, -0.0682424133646727f, 1.0f, -0.0682424133646713f,
	-0.990685946036331f, 0.203456013052633f, 0.962917287347799f, -0.334879612170984f, -0.917211301505454f, 0.460065037731152f,
	0.854419404546490f, -0.576680322114865f, -0.775711290704423f, 0.682553143218654f
};
#else
static CyFLOAT lDctMatrix[CEPS_NUM][TBF_NUM];
#endif


// 初始化窗函数
static CyVOID InitWindow(CyINT16 frmLength);

// 加窗
static CyVOID DoWindow(CyFLOAT *data, CyINT16 frmLength);

//////////////////////////////////////////////////////////////////////////


// 初始化三角滤波器参数
static CyVOID InitFilterBankParam(CyINT16 frmLength, CyINT16 SamplingRate, CyINT16 filterNum);

/* 三角滤波器输出
CyFLOAT *tbfCoef -- 带通滤波器输出
CyINT16 filterNum -- 滤波器个数
CyFLOAT *fftMag -- 傅里叶频谱
*/
static CyVOID TriBandFilter(CyFLOAT *tbfCoef, CyINT16 filterNum, CyFLOAT *fftMag);

// 赫兹频率转换为mel频率
static CyFLOAT Freq2Mel(CyFLOAT freq);
// mel频率转换为赫兹频率
static CyFLOAT Mel2Freq(CyFLOAT mel);

//////////////////////////////////////////////////////////////////////////
// 一帧语音0均值化, 或去直流偏移
static CyVOID FrmZeroMean(CyFLOAT *data, CyINT16 frmLength);

// 一帧语音预增强
static CyVOID FrmPreEmphasis(CyFLOAT *data, CyINT16 frmLength);

//////////////////////////////////////////////////////////////////////////
// 离散余弦变换

// 初始化DCT矩阵
static CyVOID InitDctMatrix(CyINT16 filterNum, CyINT16 cepsDim);

// mel倒谱参数输出
static CyVOID MelCepstrum(FVector feature, CyFLOAT *tbfCoef, CyINT16 filterNum, CyINT16 cepsDim);

// 提取一帧语音的MFCC特征
CyVOID GetFrmStaticMFCC(FVector feature, CyFLOAT *data, CyINT16 frmLength)
{
	CyFLOAT tbfCoef[TBF_NUM];  // 存储三角滤波器输出结果

	// Step 1: Remove DC Shift
	FrmZeroMean(data, frmLength);

	// Step 2: Pre-emphasis.
	FrmPreEmphasis(data, frmLength);

	// Step 3: hamming window
	DoWindow(data, frmLength);

	// Step 4: fast fourier transform and get the energy
	RealFFT(data, frmLength);

	// Step 5: triangular bandpass filter.
	TriBandFilter(tbfCoef, TBF_NUM, data);

	// Step 6: cosine transform. (Using DCT to get L order mel-scale-cepstrum parameters.)
	MelCepstrum(feature, tbfCoef, TBF_NUM, CEPS_NUM);
}

CyVOID FrmZeroMean(CyFLOAT *data, CyINT16 frmLength)
{
	CyINT16 i;
	CyFLOAT mean = data[0];
	
	// Step 1: 计算均值
	for (i=1; i<frmLength; i++)
	{
		mean += data[i];
	}
	mean /= (CyFLOAT)frmLength;

	// Step 2: 移除偏移
	for (i=0; i<frmLength; i++)
	{
		data[i] -= mean;       // 式(2.3)
	}
}


CyVOID FrmPreEmphasis(CyFLOAT *data, CyINT16 frmLength)
{
	CyINT16 i;
	for (i=frmLength-1; i; i--)
	{
		data[i] -= (PRE_EM_COEF*data[i-1]);   // 式(2.2)
	}
}

CyVOID DoWindow(CyFLOAT *data, CyINT16 frmLength)
{
	CyINT16 i;
	for (i=0; i<frmLength; i++)
	{
		data[i] *= lWindowCoef[i];  // pp.12 Sw[n]=w[n]*s[n]
	}
}

CyVOID InitWindow(CyINT16 frmLength)
{
	CyINT16 i;
	for( i=0; i<frmLength; i++ )
	{
#if (WIN_OPT==WIN_HAMMING)
		lWindowCoef[i] = 0.54f - 0.46f*cos( (CyFLOAT)i*_2PI/(CyFLOAT)(frmLength-1) );  // 式(2.5)
#elif (WIN_OPT==WIN_HANNING)
		lWindowCoef[i] = 0.5f - 0.5f*cos( (CyFLOAT)i*_2PI/(CyFLOAT)(frmLength-1) );
#else
		lWindowCoef[i] = 1.0f;
#endif	
    }
}

CyVOID InitFilterBankParam(CyINT16 frmLength, CyINT16 SamplingRate, CyINT16 filterNum)
{
	CyINT16 i;
	CyFLOAT maxMelFreq = Freq2Mel( (CyFLOAT)SamplingRate/2 );
	CyFLOAT sideWidth=maxMelFreq/(CyFLOAT)(filterNum+1);

	for (i=0; i<=filterNum; i++)
	{
		lFilterBankParam[i] = 
			(CyINT16)(Mel2Freq((CyFLOAT)i*sideWidth)/(CyFLOAT)SamplingRate*frmLength);
	}
	lFilterBankParam[filterNum+1] = frmLength/2-1;
}

// 赫兹频率转换为mel频率
CyFLOAT Freq2Mel( CyFLOAT freq )
{
	return 2595.0f*log10(1.0f+freq/700.0f);
}

// mel频率转换为赫兹频率
CyFLOAT Mel2Freq( CyFLOAT mel )
{
	//return 700.0f*(pow(10.0f, mel/2595.0f)-1.0f);
	return 700.0f*(exp(mel/1127.0f)-1.0f);   // 式(2.14)
}

CyVOID InitMfccParam()
{
	// 当为256时，使用初始值，而不进行这一步操作，下同!!!
#if !((FRAME_SIZE == 256) && (WIN_OPT==WIN_HAMMING))
	InitWindow( FRAME_SIZE );
#endif
	
#if !((TBF_NUM == 23) && (SAMPLE_RATE==8000) && (FRAME_SIZE==256))
	InitFilterBankParam( FRAME_SIZE, SAMPLE_RATE, TBF_NUM);
#endif

#if !((CEPS_NUM==12) && (TBF_NUM==23))
	InitDctMatrix(TBF_NUM, CEPS_NUM);
#endif
	
	InitFFT(FRAME_SIZE);
}

CyVOID TriBandFilter(CyFLOAT *tbfCoef, CyINT16 filterNum, CyFLOAT *fftMag)
{
	CyINT16 i, j;
	CyFLOAT filterMag[FRAME_SIZE/2+1];
	
	for (i=0; i<filterNum; i++)
	{
		// lFilterBankParam[i  ] --- start
		// lFilterBankParam[i+1] --- center
		// lFilterBankParam[i+2] --- end
		// 式(2.12)
		for (j=lFilterBankParam[i]; j<=lFilterBankParam[i+1]; j++)
		{
			filterMag[j] = (CyFLOAT)(j-lFilterBankParam[i])/(CyFLOAT)(lFilterBankParam[i+1]-lFilterBankParam[i]);
		}
		for (j=lFilterBankParam[i+1]+1; j<=lFilterBankParam[i+2]; j++)
		{
			filterMag[j] = 1.0f-(CyFLOAT)(j-lFilterBankParam[i+1])/(CyFLOAT)(lFilterBankParam[i+2]-lFilterBankParam[i+1]);
		}

		// 式(2.15)
		tbfCoef[i] = 0;
		for (j=lFilterBankParam[i]; j<=lFilterBankParam[i+2]; j++)
		{
			tbfCoef[i] += filterMag[j]*fftMag[j];
		}
		//tbfCoef[i] = log(EPS+tbfCoef[i]*tbfCoef[i]);
		tbfCoef[i] = log(EPS+tbfCoef[i]);
	}
}

CyVOID InitDctMatrix(CyINT16 filterNum, CyINT16 cepsDim)
{
	CyINT16 m, d;
	
	for (d=1; d<=cepsDim; d++)
	{
		for (m=0; m<filterNum; m++)
		{
			// 式(2.16), 式(6.145)
			lDctMatrix[d-1][m] = cos((CyFLOAT)d*((CyFLOAT)m+0.5)*_PI/(CyFLOAT)filterNum);
		}
	}
}

CyVOID MelCepstrum(FVector feature, CyFLOAT *tbfCoef, CyINT16 filterNum, CyINT16 cepsDim)
{
	CyINT16 m, d;

	for (d=0; d<cepsDim; d++)
	{
		feature[d] = 0.0f;
		for(m=0; m<filterNum; m++)
		{
			feature[d] += tbfCoef[m]*lDctMatrix[d][m];
		}
	}
}

//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
BlockTRACE_Begin
CyVOID PrintCoef()
{
	CyINT16 i, m, d;
	printf("Windowing ... \n");
	for (i=0; i<FRAME_SIZE; i++)
	{
		printf("%4cWindowCoef[%3d] = %3.14f\n", '\0',i, lWindowCoef[i]);
	}

	printf("FilterBankParam ... \n");
	for (i=0; i<TBF_NUM; i++)
	{
		printf("%4cFilterBankParam[%3d] = %6d%6d%6d\n", '\0',i, lFilterBankParam[i], lFilterBankParam[i+1], lFilterBankParam[i+2]);
	}

	printf("DCT Matrix ... \n");
	for(d=0; d<CEPS_NUM; d++)
	{
		for (m=0; m<TBF_NUM; m++)	
		{
			printf("%4cDctMatrix[%2d][%2d] = %3.14f\n", '\0', m, d, lDctMatrix[d][m]);
		}
		printf("-----------------------------------------------------------------\n");
	}
}

CyVOID FunctionTest()
{
	CyFLOAT fftMag[FRAME_SIZE/2]={
		0.000279443589129606f,
		0.0215529809393715f,
		0.0275864696054004f,
		0.00939472228347112f,
		0.00681645613206616f,
		0.00629011635430074f,
		0.00846423600583937f,
		0.00551441339535413f,
		0.00399411876224229f,
		0.00925110495723566f,
		0.00450408301607591f,
		0.00319833062360542f,
		0.0115876624577594f,
		0.00494970691330318f,
		0.0231195620770837f,
		0.0163397968119238f,
		0.00442846108782118f,
		0.00982620314400162f,
		0.0219866645863642f,
		0.00379255964650111f,
		0.0133141477015148f,
		0.0164721767629498f,
		0.00487713154863369f,
		0.00252548085660347f,
		0.00261413997247742f,
		0.00202187971892315f,
		0.00802995598700070f,
		0.0176557603339674f,
		0.0129643188102117f,
		0.00331860982446954f,
		0.0112386189870287f,
		0.00460811561382073f,
		0.00427169803877618f,
		0.00287938552650704f,
		0.0163978728495365f,
		0.00691669383415087f,
		0.0100725965422786f,
		0.00849283497619157f,
		0.00370770594486178f,
		0.00179043724745107f,
		0.00818005714771523f,
		0.00340597279253160f,
		0.00450376824491866f,
		0.00190286581558734f,
		0.00350733522539242f,
		0.00271754537954512f,
		0.00664520844448256f,
		0.00567283347099772f,
		0.00388857707810396f,
		0.00693625075996814f,
		0.00502200220037061f,
		0.00280317778874346f,
		0.00505596432905653f,
		0.00263800370394029f,
		0.00541712467223031f,
		0.00231228751648704f,
		0.00422513262805756f,
		0.00501805010703845f,
		0.00488997261582267f,
		0.00598441417939447f,
		0.00568072443755219f,
		0.00478547574656076f,
		0.00594707675199244f,
		0.00464191379770008f,
		0.00421440432511920f,
		0.00420910899249880f,
		0.00409665232465577f,
		0.00363579696334787f,
		0.00318625457962559f,
		0.00277655747226035f,
		0.00176817324816686f,
		0.00224368395894664f,
		0.00434705319842117f,
		0.00633750419139360f,
		0.00253719954261644f,
		0.00323665320516756f,
		0.00414358934553045f,
		0.00619604117778274f,
		0.00698993227456560f,
		0.00407321957755589f,
		0.00501113904552082f,
		0.00596772282402723f,
		0.00124570837701862f,
		0.00580665559249065f,
		0.00314935831613562f,
		0.00557062774512992f,
		0.00368668215578057f,
		0.00233554376483688f,
		0.00516828949136230f,
		0.00213897009003617f,
		0.00370002058851975f,
		0.00424502648914108f,
		0.00306164515207175f,
		0.00253896879048438f,
		0.000934920250004491f,
		0.00298279344928162f,
		0.00183929939493722f,
		0.00159922311296681f,
		0.00413274850204127f,
		0.00244931970444388f,
		0.00404128382188124f,
		0.00728709681726067f,
		0.00589412982388908f,
		0.00580068675379065f,
		0.00458110609699527f,
		0.00657633546718226f,
		0.00241374802888765f,
		0.00516985159824127f,
		0.00415144560198382f,
		0.00162369995282279f,
		0.00296976239560124f,
		0.00145126187254096f,
		0.00526015545761728f,
		0.00138359476571752f,
		0.000167396293542733f,
		0.000244567202518591f,
		0.000713060138380814f,
		0.00320480730170127f,
		0.00332445560618919f,
		0.00591619993202460f,
		0.00267461493922654f,
		0.00339422110714949f,
		0.00329449565238759f,
		0.00214749460121054f,
		0.00471513735798421f,
		0.00440985531862211f,
		0.00209418262042632f,
		0.00429972062241315f
	};
	CyFLOAT tbfCoef[TBF_NUM];
	CyINT16 i;
	FVector fea;

	TriBandFilter(tbfCoef, TBF_NUM, fftMag);

	for (i=0; i<TBF_NUM; i++)
	{
		printf("%4ctbfCoef[%3d] = %3.14f\n", '\0',i, tbfCoef[i]);
	}

	MelCepstrum(fea, tbfCoef, TBF_NUM, CEPS_NUM);

	for (i=0; i<CEPS_NUM; i++)
	{
		printf("%4cfea[%2d] = %3.14f\n", '\0',i, fea[i]);
	}

	return;
}
BlockTRACE_End
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////