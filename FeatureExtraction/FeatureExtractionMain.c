#include "../SRParamSet/asrconfig.h"
#include "../SRParamSet/typedef.h"
#include "../SRParamSet/datadef.h"
#include "MFCC.h"
#include <stdio.h>
#include "FeatureExtraction.h"
#include "DeltaFeature.h"
#include "FeatureTransform.h"


void TestForMFCC();

void TestForDelta();

void TestForDelta2();


int main()
{
	//TestForDelta2();
	TestForDelta();
	//TestForMFCC();

	return 0;
}


void TestForDelta2()
{
	FeatureSeq feaSeq;
	CyFLOAT tmp;
	CyINT16 i,j;
	FILE *feaFile = fopen("StaticMFCC_12x23.txt", "rt");
	
	ResetFeaSeq(&feaSeq);
	
	for (j=0; j<23; j++, feaSeq.dFeaCounter++)
	{
		for (i=0; i<12; i++)
		{
			fscanf(feaFile, "%f", &tmp);
			feaSeq.feature[j][i] = tmp;
		}
	}
	
	Delta1Feature(&feaSeq);
	//Delta2Feature(&feaSeq);
	
	CMVN(&feaSeq);
	
	fclose(feaFile);
}

void TestForDelta()
{
	VoiceBuffer vbuff;
	FeatureSeq feaSeq;
	CyFLOAT tmp;
	CyINT16 i;
	FILE *speechFile = fopen("speechdata.txt", "rt");
	
	ResetVoiceBuffer(&vbuff);
	ResetFeaSeq(&feaSeq);

	i=0;
	while( fscanf(speechFile, "%f", &tmp)!=EOF )
	{
		i++;
		printf("[%4d]  %3.14lf\n", i, tmp);
		vbuff.fData[vbuff.iSmplCounter++] = tmp;
	}

	vbuff.uVadIdxBuf[vbuff.uVadIdxCount++] = 0;
	vbuff.uVadIdxBuf[vbuff.uVadIdxCount++] = 22;

	InitFeatureExtractionParam();

	FeatureExtraction(&feaSeq, &vbuff);
}


void TestForMFCC()
{
	CyINT16 i;
	FVector fea;
	CyFLOAT data[FRAME_SIZE]=
	{
		0.0151062011718750f,
		-0.234527587890625f,
		-0.286071777343750f,
		-0.413177490234375f,
		-0.191558837890625f,
		0.322143554687500f,
		0.744232177734375f,
		0.700805664062500f,
		0.423217773437500f,
		-0.175354003906250f,
		-0.496673583984375f,
		-0.363708496093750f,
		-0.0500793457031250f,
		0.374603271484375f,
		0.564849853515625f,
		0.467956542968750f,
		0.246215820312500f,
		0.00234985351562500f,
		-0.192169189453125f,
		-0.184448242187500f,
		-0.0722045898437500f,
		0.0988769531250000f,
		0.323883056640625f,
		0.314422607421875f,
		0.157806396484375f,
		-0.0734558105468750f,
		-0.292846679687500f,
		-0.309509277343750f,
		-0.206756591796875f,
		-0.0199279785156250f,
		-0.0263977050781250f,
		-0.117980957031250f,
		-0.391082763671875f,
		-0.844024658203125f,
		-0.885955810546875f,
		0.175994873046875f,
		0.784973144531250f,
		0.999938964843750f,
		0.900024414062500f,
		-0.195983886718750f,
		-0.818939208984375f,
		-1.0f,
		-0.757812500000000f,
		0.0840454101562500f,
		0.724792480468750f,
		0.629547119140625f,
		0.450225830078125f,
		0.128479003906250f,
		-0.255249023437500f,
		0.0514526367187500f,
		-0.139617919921875f,
		-0.205017089843750f,
		-0.282318115234375f,
		-0.342163085937500f,
		-0.0628356933593750f,
		0.439941406250000f,
		0.701385498046875f,
		0.615478515625000f,
		0.260467529296875f,
		-0.331817626953125f,
		-0.477142333984375f,
		-0.314453125000000f,
		0.0889587402343750f,
		0.478332519531250f,
		0.539062500000000f,
		0.365905761718750f,
		0.115753173828125f,
		-0.123077392578125f,
		-0.184020996093750f,
		-0.135192871093750f,
		-0.00244140625000000f,
		0.190704345703125f,
		0.254180908203125f,
		0.194580078125000f,
		0.0274658203125000f,
		-0.184844970703125f,
		-0.283721923828125f,
		-0.245452880859375f,
		-0.155944824218750f,
		-0.0812072753906250f,
		-0.186065673828125f,
		-0.391387939453125f,
		-0.776611328125000f,
		-0.856018066406250f,
		0.228668212890625f,
		0.768737792968750f,
		0.999938964843750f,
		0.863586425781250f,
		-0.224884033203125f,
		-0.822998046875000f,
		-1.0f,
		-0.760681152343750f,
		0.0952148437500000f,
		0.768707275390625f,
		0.675048828125000f,
		0.524932861328125f,
		0.0782165527343750f,
		-0.304351806640625f,
		-0.0317687988281250f,
		-0.214477539062500f,
		-0.162841796875000f,
		-0.224548339843750f,
		-0.237640380859375f,
		0.00473022460937500f,
		0.476104736328125f,
		0.659912109375000f,
		0.598388671875000f,
		0.209167480468750f,
		-0.354278564453125f,
		-0.437011718750000f,
		-0.282226562500000f,
		0.154479980468750f,
		0.471984863281250f,
		0.493530273437500f,
		0.322204589843750f,
		0.0734558105468750f,
		-0.108825683593750f,
		-0.126708984375000f,
		-0.0830078125000000f,
		0.0396728515625000f,
		0.181213378906250f,
		0.234191894531250f,
		0.164459228515625f,
		0.0109252929687500f,
		-0.184082031250000f,
		-0.235260009765625f,
		-0.185150146484375f,
		-0.125610351562500f,
		-0.0919799804687500f,
		-0.240417480468750f,
		-0.414306640625000f,
		-0.906951904296875f,
		-0.706756591796875f,
		0.407257080078125f,
		0.784179687500000f,
		0.999938964843750f,
		0.714233398437500f,
		-0.355438232421875f,
		-0.854187011718750f,
		-1.0f,
		-0.654785156250000f,
		0.271667480468750f,
		0.791198730468750f,
		0.691436767578125f,
		0.562133789062500f,
		-0.0613098144531250f,
		-0.250091552734375f,
		-0.0794067382812500f,
		-0.267211914062500f,
		-0.119964599609375f,
		-0.170654296875000f,
		-0.144561767578125f,
		0.156799316406250f,
		0.525390625000000f,
		0.616363525390625f,
		0.553924560546875f,
		0.0631103515625000f,
		-0.321472167968750f,
		-0.389129638671875f,
		-0.169189453125000f,
		0.267944335937500f,
		0.476989746093750f,
		0.463348388671875f,
		0.254608154296875f,
		-0.00918579101562500f,
		-0.148590087890625f,
		-0.116760253906250f,
		-0.0390930175781250f,
		0.137420654296875f,
		0.255249023437500f,
		0.187255859375000f,
		0.0912170410156250f,
		-0.149658203125000f,
		-0.301727294921875f,
		-0.247833251953125f,
		-0.170898437500000f,
		-0.0876770019531250f,
		-0.200286865234375f,
		-0.491424560546875f,
		-0.983734130859375f,
		-0.606719970703125f,
		0.495758056640625f,
		0.847351074218750f,
		0.999938964843750f,
		0.561218261718750f,
		-0.519622802734375f,
		-0.922821044921875f,
		-1.0f,
		-0.514709472656250f,
		0.451812744140625f,
		0.869720458984375f,
		0.768035888671875f,
		0.476226806640625f,
		-0.235137939453125f,
		-0.259155273437500f,
		-0.163848876953125f,
		-0.248474121093750f,
		-0.0597229003906250f,
		-0.136657714843750f,
		-0.0859680175781250f,
		0.296051025390625f,
		0.530853271484375f,
		0.607147216796875f,
		0.430389404296875f,
		-0.118103027343750f,
		-0.370300292968750f,
		-0.355957031250000f,
		-0.0276489257812500f,
		0.390716552734375f,
		0.509765625000000f,
		0.347869873046875f,
		0.135345458984375f,
		-0.156707763671875f,
		-0.177703857421875f,
		-0.0655212402343750f,
		0.0364685058593750f,
		0.223571777343750f,
		0.210296630859375f,
		0.110321044921875f,
		-0.0281982421875000f,
		-0.259155273437500f,
		-0.303833007812500f,
		-0.226959228515625f,
		-0.174804687500000f,
		-0.190490722656250f,
		-0.347839355468750f,
		-0.747924804687500f,
		-0.908355712890625f,
		0.172576904296875f,
		0.748504638671875f,
		0.996765136718750f,
		0.898529052734375f,
		-0.214691162109375f,
		-0.843719482421875f,
		-1.0f,
		-0.810058593750000f,
		0.140502929687500f,
		0.814331054687500f,
		0.848052978515625f,
		0.650787353515625f,
		0.00469970703125000f,
		-0.393341064453125f,
		-0.184204101562500f,
		-0.306304931640625f,
		-0.119415283203125f,
		-0.0177917480468750f,
		-0.0982666015625000f,
		0.222320556640625f,
		0.475952148437500f,
		0.558471679687500f,
		0.503234863281250f,
		0.0222778320312500f,
		-0.316131591796875f,
		-0.376892089843750f,
		-0.112548828125000f,
		0.292053222656250f	
	};
	
	InitMfccParam();
	
	//PrintCoef();
	//FunctionTest();
	GetFrmStaticMFCC(fea, data, FRAME_SIZE);
	
	for (i=0; i<CEPS_NUM; i++)
	{
		printf("[%2d]: %3.14f\n", i, fea[i]);
	}
}